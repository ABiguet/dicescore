{% extends 'layout.twig' %}
{% block body %}
	<a href="/">Retour</a>
	<h1>{{ title }}</h1>
	<button class="btn btn-secondary mb-2" id="toggleTotalsBtn" type="button">Afficher les totaux</button>
	<div id="totalsTableWrapper" style="display:none;">
		<ul class="list-group">
			{% for joueur in joueurs %}
				<li class="list-group-item">
					Total
					<span style="color: {{ joueur.color }};">{{ joueur.name }}</span>
					:
					<input type="number" id="total_joueur_{{ loop.index }}_global" name="total_joueur_{{ loop.index }}_global" readonly>
				</li>
			{% endfor %}
		</ul>
	</div>
	<hr>
	<table class="table table-bordered table-striped text-center align-middle">
		<thead class="table-dark">
			<tr>
				<th>Figures</th>
				{% for joueur in joueurs %}
					{% for col in colonnesParJoueur %}
						<th style="background: {{ joueur.color }};">
							{{ joueur.name }}
							{% if col.label %}
								<b>{{ col.label }}</b>
							{% endif %}
						</th>
					{% endfor %}
				{% endfor %}
			</tr>
		</thead>
		<tbody>
			{% for fig in figures %}
				<tr>
					<td>{{ fig.label }}</td>
					{% for joueur in joueurs %}
						{% for col in colonnesParJoueur %}
							<td>
								{% if fig.fixed is defined and fig.fixed %}
									<div class="form-check form-check-inline">
										<input class="form-check-input" type="checkbox" name="{{ fig.name }}_{{ loop.parent.loop.index }}_{{ loop.index }}_valide" id="{{ fig.name }}_{{ loop.parent.loop.index }}_{{ loop.index }}_valide" value="{{ fig.fixed }}">
										<label class="form-check-label text-success fw-bold" for="{{ fig.name }}_{{ loop.parent.loop.index }}_{{ loop.index }}_valide">✔️</label>
									</div>
									<div class="form-check form-check-inline">
										<input class="form-check-input" type="checkbox" name="{{ fig.name }}_{{ loop.parent.loop.index }}_{{ loop.index }}_annule" id="{{ fig.name }}_{{ loop.parent.loop.index }}_{{ loop.index }}_annule" value="0">
										<label class="form-check-label" for="{{ fig.name }}_{{ loop.parent.loop.index }}_{{ loop.index }}_annule">❌</label>
									</div>
								{% else %}
									{% if fig.multiple %}
										<div class="input-group input-group-sm">
											<button class="btn btn-outline-secondary decrement-btn" type="button" id="decrementBtn">
												<i class="bi bi-dash" style="color: red; font-size: 0.8rem;"></i>
											</button>
											<input type="number" class="form-control text-center" name="{{ fig.name }}_{{ loop.parent.loop.index }}_{{ loop.index }}" id="{{ fig.name }}_{{ loop.parent.loop.index }}_{{ loop.index }}" step="{{ fig.multiple }}" max="{{ fig.multiple * 5 }}">
											<button class="btn btn-outline-secondary increment-btn" type="button" id="incrementBtn">
												<i class="bi bi-plus" style="color: green; font-size: 0.8rem;"></i>
											</button>
										</div>
									{% else %}
										<input type="number" class="form-control input-xs text-center" name="{{ fig.name }}_{{ loop.parent.loop.index }}_{{ loop.index }}" id="{{ fig.name }}_{{ loop.parent.loop.index }}_{{ loop.index }}" {% if fig.readonly %} readonly {% endif %}>
									{% endif %}
									<label for="{{ fig.name }}_{{ loop.parent.loop.index }}_{{ loop.index }}" class="visually-hidden">{{ fig.label }}
										{{ joueur.name }}
										Colonne
										{{ loop.parent.loop.index }}
									</label>
								{% endif %}
							</td>
						{% endfor %}
					{% endfor %}
				</tr>
			{% endfor %}
		</tbody>
	</table>
	<button class="btn btn-danger" id="resetBtn">Reset</button>
	<script type="text/javascript">
		window.yamFigures = {{ figures|json_encode|raw }};
		document.addEventListener('DOMContentLoaded', function () {
			const btn = document.getElementById('toggleTotalsBtn');
			const wrapper = document.getElementById('totalsTableWrapper');
			btn.addEventListener('click', function () {
				if (wrapper.style.display === 'none') {
					wrapper.style.display = '';
					btn.textContent = 'Masquer les totaux';
				} else {
					wrapper.style.display = 'none';
					btn.textContent = 'Afficher les totaux';
				}
			});
		});
	</script>
	<script type="module" src="/javascripts/yams/main.js"></script>
{% endblock %}
