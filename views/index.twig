{% extends 'layout.twig' %}

{% block body %}
    <!-- Header avec titre et icône -->
    <div class="text-center mb-4">
        <h1 class="display-4 text-primary">
            <i class="bi bi-dice-6 me-2"></i>{{ title }}
        </h1>
        <p class="lead text-muted">Configurez votre partie de Yahtzee</p>
    </div>

    <div class="row g-4">
        <!-- Configuration de partie -->
        <div class="col-lg-6">
            <div class="card h-100 shadow-sm">
                <div class="card-header bg-primary text-white">
                    <h5 class="card-title mb-0">
                        <i class="bi bi-gear-fill me-2"></i>Configuration
                    </h5>
                </div>
                <div class="card-body">
                    <!-- Type de partie -->
                    <div class="mb-4">
                        <label class="form-label fw-bold">Type de partie :</label>
                        <div class="d-flex gap-3">
                            <div class="form-check">
                                <input class="form-check-input" type="radio" name="gameType" id="classicGame" value="classic">
                                <label class="form-check-label" for="classicGame">
                                    <i class="bi bi-clock me-1"></i>Classique
                                </label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="radio" name="gameType" id="turboGame" value="turbo" checked>
                                <label class="form-check-label" for="turboGame">
                                    <i class="bi bi-lightning-fill me-1"></i>Turbo
                                </label>
                            </div>
                        </div>
                    </div>

                    <hr>

                    <!-- Liste des joueurs pour la partie -->
                    <div class="mb-4">
                        <label class="form-label fw-bold">Joueurs sélectionnés :</label>
                        <ul id="playerList" class="list-group">
                        {% for player in players %}
                            <li class="list-group-item d-flex justify-content-between align-items-center player-input" data-player-id="{{ player.id }}">
                                <span class="player-name">{{ player.name }}</span>
                                <input type="color" name="player-color" value="{{ player.color }}">
                                <button class="btn btn-danger btn-sm remove-player-btn" data-player-id="{{ player.id }}">Supprimer</button>
                            </li>
                        {% endfor %}
                        </ul>
                        <div class="text-muted small mt-2" id="playerCount">Aucun joueur sélectionné</div>
                    </div>

                    <!-- Bouton démarrer -->
                    <div class="d-grid">
                        <a href="/game"><button class="btn btn-success btn-lg" id="newGameBtn">
                            <i class="bi bi-play-fill me-2"></i>Démarrer la partie
                        </button></a>
                    </div>
                </div>
            </div>
        </div>

        <!-- Gestion des joueurs -->
        <div class="col-lg-6">
            <div class="card h-100 shadow-sm">
                <div class="card-header bg-success text-white">
                    <h5 class="card-title mb-0">
                        <i class="bi bi-people-fill me-2"></i>Gestion des joueurs
                    </h5>
                </div>
                <div class="card-body">
                    <div class="table-responsive">
                        <table class="table table-hover" id="playersTable">
                            <thead class="table-light">
                                <tr>
                                    <th width="10%" class="text-center">Action</th>
                                    <th width="40%">Nom</th>
                                    <th width="30%">Couleur</th>
                                    <th width="20%" class="text-center">Suppr.</th>
                                </tr>
                            </thead>
                            <tbody id="playersTableBody">
                                {% for playerDb in playersDb %}
                                    <tr>
                                        <td class="text-center">
                                            <a href="#" class="add-player-to-game-btn text-success" 
                                              data-player-id="{{ playerDb.id }}"
                                              data-player-name="{{ playerDb.name }}"
                                              data-player-color="{{ playerDb.color }}"
                                              title="Ajouter à la partie">
                                                <i class="bi bi-plus-circle fs-5"></i>
                                            </a>
                                        </td>
                                        <td data-player-name="{{ playerDb.name }}" class="fw-medium">{{ playerDb.name }}</td>
                                        <td>
                                            <input type="color" class="form-control form-control-color" name="player-color" value="{{ playerDb.color }}" title="Couleur du joueur">
                                        </td>
                                        <td class="text-center">
                                            <button class="btn btn-outline-danger btn-sm remove-player-btn" data-player-id="{{ playerDb.id }}" title="Supprimer le joueur">
                                                <i class="bi bi-trash"></i>
                                            </button>
                                        </td>
                                    </tr>
                                {% endfor %}
                                <!-- Ligne d'ajout de nouveau joueur -->
                                <tr id="newPlayerRow" class="table-active">
                                    <td class="text-center">
                                        <i class="bi bi-plus text-muted"></i>
                                    </td>
                                    <td>
                                        <input type="text" class="form-control form-control-sm" name="playerName" placeholder="Nouveau joueur">
                                    </td>
                                    <td>
                                        <input type="color" class="form-control form-control-color form-control-sm" name="playerColor" value="#ff0000">
                                    </td>
                                    <td class="text-center">
                                        <button class="btn btn-success btn-sm" id="createPlayerBtn" title="Créer le joueur">
                                            <i class="bi bi-check-lg"></i>
                                        </button>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div class="text-muted small">
                        <i class="bi bi-info-circle me-1"></i>
                        Cliquez sur <i class="bi bi-plus-circle text-success"></i> pour ajouter un joueur à la partie
                    </div>
                </div>
            </div>
        </div>
    </div>
	
	<script>
		window.players = {{ players|json_encode|raw }};
	</script>
	<script type="module" src="/javascripts/menu.js"></script>
{% endblock %}
